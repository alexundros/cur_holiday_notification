# Календарь торгов по валютам

Данный проект создан из «спортивного» интереса. Первоначально было достаточно простое техническое задание и одна реализация на python. Но я решил попробовать переписать это же решение на нескольких других языках. По моей задумке реализация должна быть очень близка с исходному варианту. Хотя я имею опыт во многих языках которые планирую использовать в проекте, все дополнительные реализации начинаются при помощи ИИ которому дается задание переписать python реализация на другой язык. И после этого начинаются мои работа что бы заставить этот код работать. Вот тут и есть та самая «спортивная» часть =)

На первом этапе есть 4 реализации:

- python
- go
- rust
- c

Была попытка сделать zig реализацию, но она не взлетела и остается в планах. Экосистема Zig пока слишком молодая что бы легко её использовать для переноса как go или rust.

Полученная скорость работы каждой реализации на разных тестовый файлах:

*После доработки C варианта и исправления ошибок в коде 22.06.2025 получены следующие данные.*

Время отражено в секундах.

|              | 0230301-20230331.xml    | 20231201-20231231.xml    |20240201-20240229.xml    |
|--------------|-------------------------|--------------------------|-------------------------|
| Py script    | 0.001743555             | 0.002114773              | 0.002042055             |
| Py app       | 0.002596855             | 0.002716303              | 0.002786398             |
| Go app       | 0.000999400             | 0.003001000              | 0.002002300             |
| Rust app     | 0.001520000             | 0.001490900              | 0.002833100             |
| C app        | 0.001702100             | 0.001534900              | 0.001775700             |
|              | Go app                  | Rust app                 | C app                   |
| Py script    | 0.001692057             | 0.001912117              | 0.002283096             |
| Py app       | 0.002415180             | 0.002789974              | 0.002792597             |
| Go app       | 0.001500200             | 0.001500700              | 0.003001000             |
| Rust app     | 0.001095200             | 0.001502800              | 0.002288900             |
| C app        | 0.001516800             | 0.001551500              | 0.001816800             |
|              | Rust app                | Go app                   | C app                   |
| Py script    | 0.001684427             | 0.002067804              | 0.002138615             |
| Py app       | 0.002383471             | 0.003324747              | 0.002938032             |
| Go app       | 0.001501800             | 0.003498800              | 0.003000700             |
| Rust app     | 0.001105300             | 0.001616500              | 0.002502600             |
| C app        | 0.001551200             | 0.001552900              | 0.001629000             |
|              | Rust app                | C app                    | C app                   |

Интересные и ожидаемые результаты побед по лучшему времени: Go - 2, Rust - 3, C - 4

## TODO

<small>*Обновление 22.06.2025*</small>

- [ ] Добавление Linux сборки
- [ ] Добавление сборки Docker образов
- [ ] Добавление сборки в github actions
- [x] Добавление реализации на C
- [ ] Добавление реализации на Zig
- [ ] Добавление 100% покрытия тестами
- [ ] Возможно: (но это не так интересно)
  - [ ] Добавление реализации на Java/Kotlin
  - [ ] Добавление реализации на C#

## Zig project

Проведена небольшая работа, но сразу получены слабые результаты. В код добавлены некоторые точки вывода `*...` в которых выведена информация о времени обработки участка.

Запуск: `zig_project\zig-out\bin\zig_project.exe test_xmlfiles/0230301-20230331.xml`
```
* find dirs : 0.0004325 сек.
# Директория приложения: zig_project\zig-out\bin
# Рабочая директория: .
# Конфиг: cur_holiday_notification.cfg
* getCfgFile: 0.0003594 сек.
* parser.loadFile: 0.0005510 сек.
# Обработка завершена: 0.0017184 сек.
```
Уже даже только с обработкой конфига приложение выполняется более 0.0017 сек.

## Техническое задание

1\) Утилита должна быть автономна и запускаться без каких-либо дополнительных настроек.

2\) В состав утилиты входит настроечный файл, содержащий в себе информацию о связке валютного инструмента и валюты. Предлагается использовать обычный текстовый файл (кодировка Win-1251), где в каждой строке содержится пара по валюте: «валютная инструмент» = «валюта». Если строка начинается с символа «;», то данная строка считается комментарием и не подлежит обработке.

```ini
; Файл настроек утилиты «Календарь валют» от 25.05.2025
[features]
; Выборка общих праздников
HDay = true
[items]
; Информация представлена строкой «валютная инструмент» = «валюта»
CNYRUB_TOD = CNY
USDRUB_TOD = USD
HKDRUB_TOD = HKD
```

Утилита не проверяет целостность данных и не контролирует верность заполнения настроечного файла. В случае невозможности прочитать файл или распарсить информацию, утилита завершает работу с ошибкой «Не могу прочитать файл настроек».

3\) На вход утилите подается файл «Cur-holiday-notification-YYYYMMDD-YYYYMMDD.xml», содержащий информацию о неторговых днях по соответствующей валютному инструменту на ММВБ за период YYYYMMDD-YYYYMMDD, указанный в наименовании файла. 

Файлы с примерами приложены в «test_xmlfiles».

4\) Утилита, выбирает неторговые дни из входного файла по валютному инструменту, имеющегося в файле настроек утилиты и выводит информацию в файл результата в виде строки: «Валюта» = «Дата». 

Дата заполняется из тэга = «ReportDate», наименование валютного инструмента ищется в тэге = «SecShortName».

Например:

4.1\) В настроечном файле есть строка «KGSRUB_TOD = KGS».

4.2\) Во входном файле есть конструкция:

```xml
<CUX50 ReportDate="2023-03-21">
<GROUP TradeGroup="N" DescribeGroup="">
    <SECURITY SecurityId="KGSRUBTODTOM" SecShortName="KGS\_TODTOM" ReWritable="Y"/>
    <SECURITY SecurityId="KGSRUB\_TOD" SecShortName="KGSRUB\_TOD" ReWritable="Y"/>
    <SECURITY SecurityId="KZTRUBTDSTMS" SecShortName="KZT\_TDSTMS" ReWritable="Y"/>
    </GROUP>
</CUX50>
```

4.3\) То в выходной файл выводим строку: KGS = 2023-03-21. Выполняем для всех строк настроечного файла и входного файла.

Пример файла результата:

```
; Файл результата утилиты «Календарь валют»
CNY = 2024-02-12
CNY = 2024-02-13
CNY = 2024-02-14
USD = 2024-02-19
```

В случае невозможности создать или записать информацию в выходной файл, утилита завершает работу с ошибкой «Не могу создать/записать файл результата».


5\) Утилита, выбирает праздничные дни из входного файла, которые в файле как «H» (Holliday) и выводит в выходной файл в виде строки: “HDay = 2025-05-09”. В файле таких дат может быть несколько, или не быть.

```xml
<CUX50 ReportDate="2025-05-09">
    <GROUP TradeGroup="H" DescribeGroup="">
        <SECURITY SecurityId="CALMAIN" SecShortName="" ReWritable="Y"/>
    </GROUP>
</CUX50>
```
